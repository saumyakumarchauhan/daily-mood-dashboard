<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🌈 Personal Mood Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg: #f4f7f9;
      --fg: #333;
      --card: #fff;
      --accent: #6200ea;
    }
    body.dark {
      --bg: #121212;
      --fg: #f1f1f1;
      --card: #1e1e1e;
    }
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg);
      color: var(--fg);
      margin: 0;
      padding: 2rem;
      max-width: 1000px;
      margin: auto;
      transition: all 0.4s ease;
    }
    h1, h2 {
      text-align: center;
      color: var(--accent);
    }
    .toggle-btn {
      position: fixed;
      top: 1rem;
      right: 1rem;
      padding: 0.6rem 1.2rem;
      background: var(--card);
      color: var(--fg);
      border: 1px solid #aaa;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .toggle-btn:hover {
      background-color: var(--accent);
      color: white;
    }
    .quote, .summary {
      text-align: center;
      margin: 1rem 0;
      font-size: 1.1rem;
    }
    canvas {
      width: 100% !important;
      max-width: 800px;
      margin: auto;
      display: block;
      background: var(--card);
      padding: 1rem;
      border-radius: 10px;
    }
    .heatmap {
      margin: 2rem 0;
      text-align: center;
    }
    .heatmap img {
      border-radius: 8px;
      max-width: 800px;
      width: 100%;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    .legend, .footer {
      text-align: center;
      margin-top: 1rem;
    }
    pre {
      background: var(--card);
      padding: 1rem;
      white-space: pre-wrap;
      border-radius: 6px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <button class="toggle-btn" onclick="toggleDarkMode()">🌓 Toggle Dark Mode</button>
  <h1>🌈 Mood & Productivity Dashboard</h1>
  <p class="quote" id="daily-quote">Loading quote...</p>

  <h2>📊 Weekly Mood & Productivity Trend</h2>
  <canvas id="trendChart"></canvas>

  <div class="legend">
    <span>😞 Very Low</span> | <span>🙁 Low</span> | <span>😐 Neutral</span> | <span>🙂 Good</span> | <span>😄 Great</span>
  </div>

  <div class="summary" id="summary">Calculating weekly average...</div>

  <div class="heatmap">
    <h2>📆 Mood Calendar Heatmap</h2>
    <img src="mood_calendar.png" alt="Mood Calendar Heatmap">
  </div>

  <h2>📘 Mood Logs</h2>
  <pre id="log-content">Loading logs...</pre>

  <p class="footer">UI designed by <strong>Saumyakumar Chauhan</strong> — B.Tech CSE @ IIIT Kota | B.S. Data Science @ IIT Madras</p>

  <script>
    function toggleDarkMode() {
      document.body.classList.toggle('dark');
    }

    fetch('log.md')
      .then(res => res.text())
      .then(text => {
        document.getElementById('log-content').innerText = text;

        const lines = text.trim().split('\n').reverse();
        const moodScores = { "😞": 1, "🙁": 2, "😐": 3, "🙂": 4, "😄": 5 };
        const prodScores = { "Low": 1, "Medium": 2, "High": 3 };
        let dates = [], moods = [], prods = [], moodSum = 0, prodSum = 0, count = 0;

        lines.forEach(line => {
          if (line.startsWith("- Mood:")) {
            const mood = line.match(/Mood:\s*(\S+)/)?.[1];
            const prod = line.match(/Productivity:\s*(\w+)/)?.[1];
            const date = line.match(/Date:\s*([\d-]+)/)?.[1];
            if (mood && prod && date) {
              moods.push(moodScores[mood] || 3);
              prods.push(prodScores[prod] || 2);
              dates.push(date);
              moodSum += moodScores[mood] || 3;
              prodSum += prodScores[prod] || 2;
              count++;
            }
          }
        });

        if (count > 0) {
          const avgMood = (moodSum / count).toFixed(2);
          const avgProd = (prodSum / count).toFixed(2);
          document.getElementById('summary').innerText =
            `🌟 Weekly Averages → Mood: ${avgMood}/5 | Productivity: ${avgProd}/3`;
        }

        new Chart(document.getElementById('trendChart'), {
          type: 'line',
          data: {
            labels: dates.slice(0, 7).reverse(),
            datasets: [
              {
                label: "Mood",
                data: moods.slice(0, 7).reverse(),
                borderColor: "#42a5f5",
                backgroundColor: "rgba(66,165,245,0.1)",
                tension: 0.3,
              },
              {
                label: "Productivity",
                data: prods.slice(0, 7).reverse(),
                borderColor: "#66bb6a",
                backgroundColor: "rgba(102,187,106,0.1)",
                tension: 0.3,
              },
            ],
          },
          options: {
            responsive: true,
            interaction: { mode: 'index', intersect: false },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(ctx) {
                    const label = ctx.dataset.label || '';
                    return `${label}: ${ctx.raw}`;
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                max: 5,
                ticks: {
                  stepSize: 1,
                  callback: function(value) {
                    return ['❌', '😞', '🙁', '😐', '🙂', '😄'][value];
                  }
                }
              }
            }
          }
        });

        const quotes = [
          "Every day is a fresh start.",
          "You’re doing better than you think.",
          "Be kind to your mind.",
          "One step at a time is progress.",
          "You’ve got this!"
        ];
        const today = new Date().getDate();
        document.getElementById("daily-quote").innerText = "💬 " + quotes[today % quotes.length];
      });
  </script>
</body>
</html>
